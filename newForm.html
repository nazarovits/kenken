<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <title></title>
</head>
<body>

<div class="box-inner-main">
    <div id="trash1"></div>
    <div id="trash2"></div>
</div>


<script type="text/javascript">

    // *************************************
    var testObject = {
        size    : 3,
        dataObj : {
            A: [['1', '2', '3'], ['2', '3', '1'], ['3', '1', '2']],
            T: [['3', '0', '4'], ['5', '0', '0'], ['3', '3', '0']],
            S: [['+', '0', '+'], ['+', '0', '0'], ['0', '+', '0']],
            V: [['0', '1'],      ['0', '1'],      ['1', '0']],
            H: [['1', '1'],      ['1', '1'],      ['0', '1']]
        }
    };

    var testObject2 = {
        size    : 4,
        dataObj : {
            A: [['4', '2', '1', '3'], ['2', '3', '4', '1'], ['1', '4', '3', '2'], ['3', '1', '2', '4']],
            T: [['9', '0', '1', '2'], ['3', '0', '7', '0'], ['0', '4', '0', '2'], ['6', '0', '0', '0']],
            S: [['+', '0', '1', '-'], ['+', '0', '+', '0'], ['0', '1', '0', '-'], ['+', '0', '0', '0']],
            V: [['0', '1', '1'],      ['1', '1', '1'],      ['1', '1', '1']     , ['0', '0', '1']],
            H: [['1', '0', '1'],      ['0', '1', '1'],      ['1', '0', '1']     , ['0', '1', '0']]
        }
    };
    // *************************************

    var currentStateObject = new CurrentStateConstructor(testObject2);

    // function which draw out HTML version of flash puzzle
    function drawOurForm(puzzleData){
        var data = (puzzleData && puzzleData.dataObj) ? puzzleData.dataObj : {};
        var row = [];
        var puzzleSize = puzzleData.size;
        var values = data.A;
        var results = data.T;
        var symbols = data.S;
        var rightLines = data.V;
        var bottomLines = data.H;
        var lineClass;
        var result;
        var i,j;

        // ******* left panel begin
        row.push('<div>');

            // ******* notes box
            row.push('<div id="notesContainer">');

            for (i=1; i<=puzzleSize; i+=1){
                row.push('<div class="notesItem" data-id="'+i+'"><span>'+i+'<\/span><\/div>');
            }
            row.push('<div id="notesAll"><span><img src="./public/img/icn_check.png"><\/span><\/div>');
            row.push('<div id="notesDel"><span><img src="./public/img/ic_close_.png"><\/span><\/div>');

            row.push('<\/div>');

            // ******* first buttons box
            row.push('<div class="firstBtnBox">');
                row.push('<button id="btnSolve"><span>Solve Another<\/span><\/button>');
                row.push('<button id="btnResumeSaved"><span>Resume Saved Puzzle<\/span><\/button>');
            row.push('<\/div>');

            // ******* second buttons box
            row.push('<div class="secondBtnBox">');
                row.push('<button id="btnUndo"><span>Undo<\/span><\/button>');
                row.push('<button id="btnRedo"><span>Redo<\/span><\/button>');
                row.push('<button id="btnReset"><span>Reset<\/span><\/button>');
            row.push('<\/div>');

            // ******* third buttons box
            row.push('<div class="thirdBtnBox">');
                row.push('<button id="btnReveal"><span>Reveal<\/span><\/button>');
                row.push('<button id="btnCheck"><span>Check<\/span><\/button>');
                row.push('<button id="btnSolution"><span>Solution<\/span><\/button>');
            row.push('<\/div>');

        // ******* left panel end
        row.push('<\/div>');

        // ******* main panel begin
        row.push('<div>');

            // ******* top buttons
            row.push('<div id="topInfoBox">');

            row.push('<span id="puzzleInfo">Puzzle No. 000000<\/span>');
            row.push('<button id="btnPause"><span>PAUSE<\/span><\/button>');
            row.push('<div class="timerBox">');
            row.push('<span id="puzzleTimer">00:00:00<\/span>');
            row.push('<button id="btnOffTimer"><span>OFF<\/span><\/button>');
            row.push('<\/div>');

            row.push('<\/div>');

            // ******* main container
            row.push('<div id="puzzleContainer">');

            for (i=1; i<=puzzleSize; i+=1){
                row.push('<div class="puzzleRow">');
                for (j=1; j<=puzzleSize; j+=1 ){

                    lineClass = 'puzzleItem';

                    if (+rightLines[i-1][j-1]) {
                        lineClass += ' rightLineBorder'
                    }

                    if (+bottomLines[j-1][i-1]) {
                        lineClass += ' bottomLineBorder'
                    }

                    //puzzle item
                    row.push('<div id="p'+i+j+'" class="'+lineClass+'">');

                        //draw symbol and expected result
                        if (+results[i-1][j-1]){
                            row.push('<span class="itemResult">'+results[i-1][j-1]+'<\/span>');
                            if (symbols[i-1][j-1] !== '0' && symbols[i-1][j-1] !== '1'){
                                row.push('<span class="itemSymbol">'+symbols[i-1][j-1]+'<\/span>');
                            }
                        }

                        row.push('<span class="itemValue"><\/span>');

                    row.push('<\/div>');
                }
                row.push('<\/div>');
            }

            row.push('<\/div>');

            // ******* bottom container
            row.push('<div id="bottomInfoBox">');
            row.push('<div class="autoNotesBox">');
            row.push('<span>AutoNotes</span>');
            row.push('<button id="btnOnNotes"><span>ON<\/span><\/button>');
            row.push('<button id="btnOffNotes"><span>OFF<\/span><\/button>');
            row.push('<\/div>');

            row.push('<div class="savePrintBox">');
            row.push('<button id="btnSave"><span>SAVE<\/span><\/button>');
            row.push('<button id="btnPrint"><span>PRINT<\/span><\/button>');
            row.push('<\/div>');

            row.push('<\/div>');

        // ******* main panel end
        row.push('<\/div>');

        // +++++++ test circle

        row.push('<div id="testCircle">');

        for (i=1; i<=puzzleSize; i+=1){
            row.push('<div data-id="'+i+'" class="ltlCrcl">');
            row.push('<span>'+i+'<\/span>');
            row.push('<\/div>');
        }

            row.push('<div data-id="cC" class="ltlCrcl"><span><img src="./public/img/icn_eraser_.png"><\/span><\/div>');
            row.push('<div data-id="cX" class="ltlCrcl"><span><img src="./public/img/ic_close_.png"><\/span><\/div>');

        row.push('<\/div>');

        // +++++++ test circle

        result = document.createElement('div');
        result.className = 'mainContainer';
        result.innerHTML = row.join('');

        document.querySelector('.box-inner-main').appendChild(result);

        drawOurCircles();
        puzzleEvents();
    }

    function CurrentStateConstructor(puzzleData) {
        var size = puzzleData.size;
        var notesItem;
        var i = size*size;
        var j;

        this.values = [];
        this.notes = [];
        this.size = size;

        while (i > 0){
            j = size*size;
            notesItem = [];
            this.values.push(0);
            while (j > 0){
                notesItem.push(false);
                j -= 1;
            }
            this.notes.push(notesItem);
            i -= 1;
        }

        return this;
    };

    function puzzleEvents() {
        $('.puzzleItem').click(function(event) {
            var target = $(event.target).closest('.puzzleItem');
            var container = target.closest('#puzzleContainer');

            container.find('.active').removeClass('active');
            target.addClass('active');

            changeCirclePosition ();
        });

        $('.ltlCrcl').click( function(event){
            var target = $(event.target).closest('.ltlCrcl');
            var value = target.attr('data-id');
            var circle = target.closest('#testCircle');
            var currentItem = $('.puzzleItem.active');
            var currentId = currentItem.attr('id');
            var valueIndex = (currentId[1] - 1)* currentStateObject.size + +currentId[2];

            if (value !== 'cX') {
                if (value === 'cC'){value = ''}
                currentItem.find('.itemValue').text(value);
                currentStateObject.values[valueIndex-1] = value ? +value : 0;
            }
            circle.hide();
        });
    };

    function changeCirclePosition (){
        var circleDiv = $('#testCircle');
        var circlePos = findCirclePosition(60);

        circleDiv.css('top', circlePos.y);
        circleDiv.css('left', circlePos.x);
        circleDiv.css('display', 'block');
    };

    function drawOurCircles (){
        var count = testObject2.size + 2;
        var coordinates = calculateCircleButtons(60, count);
        var arrayCircles = $('.ltlCrcl');
        var top, left;

        for (var i=1; i<=count; i+=1){
            top = coordinates[i-1].y - 15;
            left = coordinates[i-1].x - 15;
            $(arrayCircles[i-1]).css({top: top, left: left})
        }

    };


    function calculateCircleButtons(argRadius, argCount) {
        var radius = argRadius;
        var count = argCount;
        var coordinatesArray = [];
        var x;
        var y;

        for (var i = 0; i < count; i++){
            x = radius + radius * Math.sin(2 / count * Math.PI * i);
            y = radius - radius * Math.cos(2 / count * Math.PI * i);

            coordinatesArray.push({x: x, y : y});
        }

        return coordinatesArray;

    };

    function findCirclePosition (circleRadius) {
        var activeSquare = $('.puzzleItem.active')[0];
        var squareWidth = activeSquare.offsetWidth;
        var squareLeft = activeSquare.offsetLeft;
        var squareTop = activeSquare.offsetTop;

        return {
            x: squareLeft + (squareWidth/2) - circleRadius,
            y: squareTop + (squareWidth/2) - circleRadius
        };
    }

    // *************************************

    drawOurForm(testObject2);
    // *************************************
</script>

</body>